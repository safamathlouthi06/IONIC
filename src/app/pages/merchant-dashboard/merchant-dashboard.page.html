<ion-header>
  <ion-toolbar color="primary" class="merchant-toolbar">
    <div class="header-content">
      <ion-buttons slot="start">
        <div class="header-brand">
          <span class="brand-emoji">🏪</span>
          <span class="brand-text">MiniMarket</span>
        </div>
      </ion-buttons>
      
   
      
      <ion-buttons slot="end">
        <ion-button (click)="goToAddProduct()" fill="clear" color="light" class="add-header-btn">
          <span class="btn-emoji">➕</span>
          <span class="btn-text">Ajouter</span>
        </ion-button>
      </ion-buttons>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content class="merchant-content">
  <!-- Section bienvenue améliorée -->
  <div class="welcome-section">
    <div class="welcome-content">
      <div class="avatar-container">
        <div class="user-avatar">
          <div class="avatar-background">
            <span class="avatar-emoji">👨‍💼</span>
          </div>
        </div>
        <div class="status-indicator"></div>
      </div>
      <div class="welcome-text">
        <h2 class="welcome-title">Bienvenue ! 👋</h2>
        <p class="welcome-subtitle">Gérez votre boutique en toute simplicité</p>
      </div>
      <!-- Déconnexion déplacée ici -->
      <button class="logout-btn-header" (click)="logout()" title="Déconnexion">
        <span class="logout-emoji">🚪</span>
      </button>
    </div>
    <div class="products-count-badge">
      <span class="badge-icon">📦</span>
      {{ filterProducts().length }} produit(s)
    </div>
  </div>

  <!-- Section filtres améliorée -->
  <div class="filters-section">
    <div class="search-container">
      <ion-searchbar 
        [(ngModel)]="searchTerm" 
        placeholder="Rechercher un produit..."
        class="custom-searchbar"
        animated
        debounce="300">
      </ion-searchbar>
    </div>

    <div class="categories-container">
      <div class="categories-scroll">
        @for (cat of categories; track cat) {
          <div 
            [class.active]="selectedCategory === cat"
            (click)="selectedCategory = cat"
            class="category-chip">
            <span class="chip-icon">{{ getCategoryEmoji(cat) }}</span>
            <span class="chip-label">{{ cat }}</span>
          </div>
        }
        <div 
          [class.active]="selectedCategory === 'All'"
          (click)="selectedCategory = 'All'"
          class="category-chip all">
          <span class="chip-icon">📱</span>
          <span class="chip-label">Tous</span>
        </div>
      </div>
    </div>
  </div>

  <!-- En-tête produits amélioré -->
  <div class="section-header">
    <div class="header-content">
      <div class="title-container">
        <span class="section-emoji">📦</span>
        <h3 class="section-title">Mes Produits</h3>
        @if (hasActiveFilters()) {
          <span class="filter-badge">
            {{ getFilteredProductsCount() }} résultat{{ getFilteredProductsCount() > 1 ? 's' : '' }}
          </span>
        }
      </div>
      @if (hasActiveFilters()) {
        <button class="clear-filters-btn" (click)="resetFilters()">
          <span class="btn-emoji">🔄</span>
          Réinitialiser
        </button>
      }
    </div>
  </div>

  <!-- Grille produits améliorée -->
  <div class="products-grid">
    @for (product of filterProducts(); track product.id; let i = $index) {
      <ion-card class="product-card">
        <div class="product-image-container">
          @if (product.imageUrl) {
            <img 
              [src]="product.imageUrl" 
              class="product-image"
              (error)="handleImageError($event)">
          }
          @if (!product.imageUrl) {
            <div class="image-overlay">
              <span class="placeholder-emoji">🖼️</span>
              <p class="placeholder-text">Aucune image</p>
            </div>
          }
          <div class="product-badge">
            <span class="badge-emoji">{{ getCategoryEmoji(product.category) }}</span>
            {{ product.category }}
          </div>
          <div class="card-overlay">
            <button class="overlay-btn" (click)="viewProduct(product)" title="Voir les détails">
              👁️
            </button>
          </div>
         
        </div>
        
        <ion-card-header class="product-header">
          <ion-card-title class="product-name">{{ product.name }}</ion-card-title>
          <ion-card-subtitle class="product-price">{{ product.price | currency:'EUR' }}</ion-card-subtitle>
        </ion-card-header>

        <ion-card-content class="product-content">
          @if (product.description) {
            <p class="product-description">
              {{ getTruncatedDescription(product.description, 100) }}
            </p>
          }
          
          <div class="product-actions">
            <button class="action-btn" (click)="viewProduct(product)">
              <span class="btn-emoji">👁️</span>
              Détails
            </button>
            <div class="action-buttons">
              <button class="icon-btn edit-btn" (click)="editProduct(product)" title="Modifier">
                ✏️
              </button>
              <button class="icon-btn delete-btn" (click)="confirmDelete(product)" title="Supprimer">
                🗑️
              </button>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    }
  </div>

  <!-- État vide amélioré -->
  @if (filterProducts().length === 0) {
    <div class="empty-state">
      <div class="empty-content">
        <div class="empty-icon-container">
          <span class="empty-emoji">📦</span>
        </div>
        <h3 class="empty-title">Aucun produit trouvé</h3>
        <p class="empty-subtitle">
          @if (searchTerm || selectedCategory !== 'All') {
            Aucun produit ne correspond à vos critères de recherche
          } @else {
            Créez votre premier produit pour commencer
          }
        </p>
        <div class="empty-actions">
          @if (searchTerm || selectedCategory !== 'All') {
            <ion-button fill="outline" (click)="resetFilters()" class="empty-action-btn">
              <span class="btn-emoji">🔄</span>
              Réinitialiser les filtres
            </ion-button>
          }
          <ion-button color="primary" (click)="goToAddProduct()" class="empty-action-btn">
            <span class="btn-emoji">➕</span>
            Ajouter un produit
          </ion-button>
        </div>
      </div>
    </div>
  }

  <!-- Bouton flottant amélioré -->
  <ion-fab vertical="bottom" horizontal="end" slot="fixed" class="main-fab">
    <ion-fab-button color="primary" (click)="goToAddProduct()" class="fab-btn">
      <span class="fab-emoji">➕</span>
    </ion-fab-button>
  </ion-fab>

  <!-- Modal produit amélioré -->
  <ion-modal [isOpen]="showProductModal" (ionModalDidDismiss)="closeModal()" class="product-modal">
    <ng-template>
      <ion-header class="modal-header">
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="closeModal()" fill="clear" class="back-btn">
              <span class="btn-emoji">⬅️</span>
              Retour
            </ion-button>
          </ion-buttons>
          <ion-title class="modal-title">Détails du produit</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="duplicateProduct(selectedProduct!)" fill="clear" class="duplicate-btn">
              <span class="btn-emoji">📋</span>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="modal-content">
        @if (selectedProduct) {
          <div class="modal-product">
            <div class="modal-image-container">
              @if (selectedProduct.imageUrl) {
                <img 
                  [src]="selectedProduct.imageUrl" 
                  class="modal-image"
                  (error)="handleImageError($event)">
              }
              @if (!selectedProduct.imageUrl) {
                <div class="no-image">
                  <span class="no-image-emoji">🖼️</span>
                  <p class="no-image-text">Aucune image disponible</p>
                </div>
              }
            </div>
            
            <div class="modal-info">
              <div class="modal-header-content">
                <h2 class="modal-product-name">{{ selectedProduct.name }}</h2>
                <div class="price-tag">
                  {{ selectedProduct.price | currency:'EUR' }}
                </div>
              </div>
              
              <div class="modal-details">
                <div class="detail-item">
                  <div class="detail-icon-container">
                    <span class="detail-emoji">💰</span>
                  </div>
                  <div class="detail-content">
                    <span class="detail-label">Prix</span>
                    <span class="detail-value">{{ selectedProduct.price | currency:'EUR' }}</span>
                  </div>
                </div>
                
                <div class="detail-item">
                  <div class="detail-icon-container">
                    <span class="detail-emoji">📂</span>
                  </div>
                  <div class="detail-content">
                    <span class="detail-label">Catégorie</span>
                    <span class="detail-value">{{ selectedProduct.category }}</span>
                  </div>
                </div>
                
                @if (selectedProduct.description) {
                  <div class="detail-item">
                    <div class="detail-icon-container">
                      <span class="detail-emoji">📝</span>
                    </div>
                    <div class="detail-content">
                      <span class="detail-label">Description</span>
                      <span class="detail-value">{{ selectedProduct.description }}</span>
                    </div>
                  </div>
                }

               
              </div>

              <div class="modal-actions">
                <ion-button expand="block" color="warning" (click)=" editProduct(selectedProduct);closeModal()"  class="modal-action-btn">
                  <span class="btn-emoji">✏️</span>
                  Modifier le produit
                </ion-button>
                <ion-button expand="block" color="danger" fill="outline" (click)="confirmDelete(selectedProduct)" class="modal-action-btn">
                  <span class="btn-emoji">🗑️</span>
                  Supprimer
                </ion-button>
              </div>
            </div>
          </div>
        }
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>